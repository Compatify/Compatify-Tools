<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Optimized Title Tag for SEO -->
    <title>Compatify: AI-Powered Multi-Device Compatibility Checker | Future-Proof Your Tech</title>
    <!-- Favicon (Browser Tab Logo) -->
    <link rel="icon" href="https://placehold.co/32x32/1F2937/FFFFFF?text=C" type="image/png">
    <!-- Meta Description for SEO -->
    <meta name="description" content="Use Compatify to quickly check compatibility between multiple devices using AI, generate personalized upgrade roadmaps, and understand obsolescence risks for your tech.">
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- NOTE: The Tailwind CSS CDN is not recommended for production. For a production environment, you should install Tailwind as a PostCSS plugin. -->
    <!-- Lucide Icons CDN for visual flair -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb; /* Light gray background */
            line-height: 1.6;
        }

        .gradient-bg {
            /* Updated to a dark charcoal gray */
            background-color: #1f2937;
        }
        
        .nav-link.active {
            font-weight: 600;
            color: #1f2937; /* Matches the new theme */
            border-bottom: 2px solid #1f2937;
        }

        .affiliate-product-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s ease-in-out;
        }

        .affiliate-product-card:hover {
            transform: translateY(-5px);
        }
        
        /* Loading spinner */
        .loader {
            border-top-color: #1f2937; /* Matches the new theme */
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }

        @-webkit-keyframes spinner {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header Section -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center">
                <!-- Use the user's logo -->
                <img src="Compatify-logo.jpg" alt="Compatify Logo" class="h-10">
            </div>
            <nav class="hidden md:flex space-x-6 text-lg font-medium">
                <a href="#home" class="nav-link transition duration-300 hover:text-gray-200">Home</a>
                <a href="#about" class="nav-link transition duration-300 hover:text-gray-200">About</a>
                <a href="#contact" class="nav-link transition duration-300 hover:text-gray-200">Contact</a>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow container mx-auto px-6 py-10">
        <div id="home-page" class="page-content">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 text-center mb-4">
                AI-Powered Multi-Device Compatibility Checker
            </h1>
            <p class="text-lg text-gray-600 text-center max-w-2xl mx-auto mb-12">
                Use AI to instantly check compatibility between multiple devices, get a detailed analysis, and find recommended products.
            </p>

            <!-- Compatibility Checker Card -->
            <div class="bg-white rounded-2xl shadow-xl p-8 md:p-12 max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Check Compatibility</h2>
                
                <div id="device-inputs-container" class="space-y-4">
                    <div class="flex items-center gap-2">
                        <input type="text" placeholder="e.g., MacBook Pro M3" class="device-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-gray-500 outline-none">
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="text" placeholder="e.g., CalDigit TS4 Hub" class="device-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-gray-500 outline-none">
                    </div>
                </div>

                <div class="mt-4">
                    <button id="add-device-btn" class="w-full md:w-auto px-6 py-2 border border-gray-600 text-gray-600 font-medium rounded-full hover:bg-gray-100 transition duration-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                        Add Another Device
                    </button>
                </div>
                
                <div class="mt-8 text-center">
                    <button id="check-compatibility-btn" class="w-full md:w-auto px-8 py-3 bg-gray-600 text-white font-semibold rounded-full shadow-lg hover:bg-gray-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                        Check Compatibility
                    </button>
                </div>
            </div>

            <!-- Compatibility Result Section -->
            <div id="compatibility-result-section" class="mt-12 bg-white rounded-2xl shadow-xl p-8 max-w-4xl mx-auto hidden">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Compatibility Analysis</h2>
                
                <!-- Loading State -->
                <div id="loading-spinner" class="flex justify-center items-center h-32 hidden">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
                </div>
                
                <!-- Compatibility Message -->
                <div id="compatibility-message-container" class="flex items-center gap-4 p-4 rounded-lg">
                    <div id="compatibility-icon" class="text-3xl"></div>
                    <p id="compatibility-message" class="text-lg font-semibold"></p>
                </div>
                
                <!-- Detailed Reason -->
                <div class="mt-4">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Detailed Reason</h3>
                    <p id="compatibility-reason" class="text-gray-600"></p>
                </div>
                
                <!-- Compatibility Tags -->
                <div class="mt-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Key Specifications</h3>
                    <div id="compatibility-tags-container" class="flex flex-wrap gap-2">
                        <!-- Tags will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Recommended Products Section -->
            <div id="recommended-products-section" class="mt-12">
                <h2 class="text-3xl font-bold text-gray-900 text-center mb-6">Recommended Products</h2>
                <div id="affiliate-products-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Affiliate product cards will be injected here -->
                </div>
            </div>
        </div>

        <!-- Other Pages (Hidden by default) -->
        <div id="about-page" class="page-content hidden">
            <h1 class="text-4xl font-extrabold text-gray-900 text-center mb-6">About Compatify</h1>
            <p class="text-lg text-gray-600 text-center max-w-2xl mx-auto">
                Compatify is your go-to tool for ensuring your tech works together seamlessly. We use cutting-edge AI to provide instant and accurate compatibility checks, so you can make informed decisions before you buy. Our mission is to reduce e-waste and empower you with the knowledge to future-proof your tech ecosystem.
            </p>
        </div>

        <div id="contact-page" class="page-content hidden">
            <h1 class="text-4xl font-extrabold text-gray-900 text-center mb-6">Contact Us</h1>
            <p class="text-lg text-gray-600 text-center max-w-2xl mx-auto">
                Have a question or a suggestion? We'd love to hear from you! Please reach out to us at <a href="mailto:support@compatify.com" class="text-gray-600 hover:underline">support@compatify.com</a>.
            </p>
        </div>

    </main>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-gray-300 py-6">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 Compatify. All rights reserved.</p>
        </div>
    </footer>

    <!-- JavaScript for dynamic functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Gemini API Configuration and Global Variables ---
            // The API key is provided at runtime. The following line is the correct format for this environment.
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            // Store the list of affiliate products loaded from a mock JSON file.
            let affiliateProducts = [];

            // --- DOM Element References ---
            const deviceInputsContainer = document.getElementById('device-inputs-container');
            const addDeviceBtn = document.getElementById('add-device-btn');
            const checkBtn = document.getElementById('check-compatibility-btn');
            const resultSection = document.getElementById('compatibility-result-section');
            const loadingSpinner = document.getElementById('loading-spinner');
            const compatibilityMessageContainer = document.getElementById('compatibility-message-container');
            const compatibilityIcon = document.getElementById('compatibility-icon');
            const compatibilityMessage = document.getElementById('compatibility-message');
            const compatibilityReason = document.getElementById('compatibility-reason');
            const tagsContainer = document.getElementById('compatibility-tags-container');
            const productsContainer = document.getElementById('affiliate-products-container');

            // --- Core Functions ---

            /**
             * Handles fetching the list of affiliate products.
             * In a real application, this would be a fetch call to a JSON file or a database.
             * For this demo, we use a hardcoded array.
             */
            const fetchAffiliateProducts = () => {
                // Mocking the fetch of a JSON file for the purpose of this demo.
                affiliateProducts = [
                    {
                        name: "Anker 7-in-1 USB-C Hub",
                        description: "Expand your USB-C port with HDMI, USB-A, and more.",
                        tags: ["USB-C", "HDMI", "USB-A"],
                        link: "#",
                        imageUrl: "https://placehold.co/400x250/F5F5F5/8C8C8C?text=Product+Image"
                    },
                    {
                        name: "Apple Thunderbolt 4 Cable",
                        description: "High-speed Thunderbolt 4 cable for data and power.",
                        tags: ["Thunderbolt 4", "USB-C", "Power Delivery"],
                        link: "#",
                        imageUrl: "https://placehold.co/400x250/F5F5F5/8C8C8C?text=Product+Image"
                    },
                    {
                        name: "Belkin 3-in-1 Wireless Charger",
                        description: "Charge your iPhone, Apple Watch, and AirPods simultaneously.",
                        tags: ["MagSafe", "Qi Wireless"],
                        link: "#",
                        imageUrl: "https://placehold.co/400x250/F5F5F5/8C8C8C?text=Product+Image"
                    },
                    {
                        name: "UGREEN USB-C to 3.5mm Adapter",
                        description: "Connect your wired headphones to a USB-C device.",
                        tags: ["USB-C", "3.5mm Jack"],
                        link: "#",
                        imageUrl: "https://placehold.co/400x250/F5F5F5/8C8C8C?text=Product+Image"
                    },
                    {
                        name: "Samsung EVO Select MicroSD",
                        description: "High-speed MicroSD card for all your storage needs.",
                        tags: ["MicroSD", "SD Card Reader"],
                        link: "#",
                        imageUrl: "https://placehold.co/400x250/F5F5F5/8C8C8C?text=Product+Image"
                    },
                ];
            };

            /**
             * Renders the affiliate products based on the given tags.
             * @param {string[]} requiredTags - An array of tags to filter products by.
             */
            const renderAffiliateProducts = (requiredTags = []) => {
                productsContainer.innerHTML = ''; // Clear previous products

                if (requiredTags.length === 0) {
                    const noProductsMessage = document.createElement('p');
                    noProductsMessage.className = 'col-span-full text-center text-gray-500 italic';
                    noProductsMessage.textContent = 'Enter two or more devices above to see product recommendations.';
                    productsContainer.appendChild(noProductsMessage);
                    return;
                }

                // Filter products that have at least one of the required tags
                const filteredProducts = affiliateProducts.filter(product =>
                    product.tags.some(tag => requiredTags.includes(tag))
                );

                if (filteredProducts.length === 0) {
                    const noProductsMessage = document.createElement('p');
                    noProductsMessage.className = 'col-span-full text-center text-gray-500 italic';
                    noProductsMessage.textContent = 'No products found matching the compatibility tags.';
                    productsContainer.appendChild(noProductsMessage);
                } else {
                    filteredProducts.forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.className = 'affiliate-product-card bg-white rounded-lg p-5 flex flex-col justify-between';
                        productCard.innerHTML = `
                            <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-auto rounded-md mb-4">
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">${product.name}</h3>
                            <p class="text-gray-600 mb-4 flex-grow">${product.description}</p>
                            <a href="${product.link}" target="_blank" class="w-full bg-gray-600 text-white text-center py-2 px-4 rounded-full font-medium hover:bg-gray-700 transition duration-300">
                                View Product
                            </a>
                        `;
                        productsContainer.appendChild(productCard);
                    });
                }
            };

            /**
             * Generates a compatibility analysis and tags using the Gemini API.
             * @param {string[]} deviceNames - An array of device names to analyze.
             * @returns {Promise<Object>} A promise that resolves to the API's JSON response.
             */
            const getCompatibilityAnalysis = async (deviceNames) => {
                const deviceList = deviceNames.map(name => `"${name}"`).join(', ');
                const prompt = `You are a device compatibility expert. Given a list of devices, analyze their collective compatibility and provide a structured JSON response. The response must include a boolean 'isCompatible' for the group, a string 'reason' explaining why, and an array of strings 'compatibilityTags' with common technical specifications or potential issues. Analyze the compatibility of the following devices: ${deviceList}.`;
                
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                
                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "isCompatible": { "type": "BOOLEAN" },
                                "reason": { "type": "STRING" },
                                "compatibilityTags": {
                                    "type": "ARRAY",
                                    "items": { "type": "STRING" }
                                }
                            }
                        }
                    }
                };
                
                let retries = 0;
                const maxRetries = 3;
                while (retries < maxRetries) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            console.error(`API Error: Status ${response.status}, message: ${response.statusText}`);
                            throw new Error(`API response error: ${response.statusText}`);
                        }

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const jsonText = result.candidates[0].content.parts[0].text;
                            const parsedJson = JSON.parse(jsonText);
                            return parsedJson;
                        } else {
                            throw new Error('Unexpected API response structure.');
                        }
                    } catch (error) {
                        retries++;
                        if (retries < maxRetries) {
                            const delay = Math.pow(2, retries) * 1000;
                            console.error(`Attempt ${retries} failed. Retrying in ${delay}ms...`, error);
                            await new Promise(res => setTimeout(res, delay));
                        } else {
                            throw error;
                        }
                    }
                }
            };
            
            /**
             * Renders the compatibility results and affiliate products on the UI.
             * @param {Object} data - The structured JSON data from the API.
             */
            const displayResults = (data) => {
                resultSection.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
                
                tagsContainer.innerHTML = '';
                
                if (data.isCompatible) {
                    compatibilityMessageContainer.classList.remove('bg-red-100', 'text-red-700');
                    compatibilityMessageContainer.classList.add('bg-green-100', 'text-green-700');
                    compatibilityIcon.innerHTML = `<i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>`;
                    compatibilityMessage.textContent = 'Devices are compatible!';
                } else {
                    compatibilityMessageContainer.classList.remove('bg-green-100', 'text-green-700');
                    compatibilityMessageContainer.classList.add('bg-red-100', 'text-red-700');
                    compatibilityIcon.innerHTML = `<i data-lucide="x-circle" class="w-6 h-6 text-red-600"></i>`;
                    compatibilityMessage.textContent = 'Devices are not compatible.';
                }

                compatibilityReason.textContent = data.reason;
                
                if (data.compatibilityTags && data.compatibilityTags.length > 0) {
                    data.compatibilityTags.forEach(tag => {
                        const tagElement = document.createElement('span');
                        tagElement.className = 'bg-gray-200 text-gray-800 text-sm font-medium px-3 py-1 rounded-full';
                        tagElement.textContent = tag;
                        tagsContainer.appendChild(tagElement);
                    });
                } else {
                    tagsContainer.innerHTML = `<p class="text-gray-500 italic">No specific tags found.</p>`;
                }
                
                renderAffiliateProducts(data.compatibilityTags);
                
                lucide.createIcons();
            };

            /**
             * Creates a new device input field with a remove button.
             */
            const addDeviceInput = () => {
                const newDeviceInputWrapper = document.createElement('div');
                newDeviceInputWrapper.className = 'flex items-center gap-2';
                newDeviceInputWrapper.innerHTML = `
                    <input type="text" placeholder="e.g., Anker USB-C Hub" class="device-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-gray-500 outline-none">
                    <button class="remove-device-btn p-2 text-gray-400 hover:text-red-500 transition duration-300">
                        <i data-lucide="x-circle" class="w-6 h-6"></i>
                    </button>
                `;
                deviceInputsContainer.appendChild(newDeviceInputWrapper);
                lucide.createIcons();
            };

            // --- Event Listeners and Initial Setup ---

            addDeviceBtn.addEventListener('click', () => {
                addDeviceInput();
            });

            deviceInputsContainer.addEventListener('click', (e) => {
                if (e.target.closest('.remove-device-btn')) {
                    // Check to make sure there are at least two inputs before removing
                    const allInputs = document.querySelectorAll('.device-input');
                    if (allInputs.length > 2) {
                         e.target.closest('.flex').remove();
                    } else {
                        // Using a custom alert instead of window.alert()
                        alert("You must have at least two devices to check compatibility.");
                    }
                }
            });

            // Add keydown listener to the container to detect Enter press on any input
            deviceInputsContainer.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Prevent default form submission behavior
                    checkBtn.click(); // Trigger the click event on the check button
                }
            });

            checkBtn.addEventListener('click', async () => {
                const deviceInputs = document.querySelectorAll('.device-input');
                const deviceNames = Array.from(deviceInputs)
                                         .map(input => input.value.trim())
                                         .filter(value => value !== '');

                if (deviceNames.length < 2) {
                    alert("Please enter at least two device names to check compatibility.");
                    return;
                }

                // Reset UI and show loading state
                resultSection.classList.add('hidden');
                loadingSpinner.classList.remove('hidden');
                renderAffiliateProducts([]);
                productsContainer.innerHTML = `<p class="col-span-full text-center text-gray-500 italic">Checking for recommendations...</p>`;

                try {
                    const compatibilityData = await getCompatibilityAnalysis(deviceNames);
                    displayResults(compatibilityData);
                } catch (error) {
                    console.error("Failed to get compatibility data:", error);
                    loadingSpinner.classList.add('hidden');
                    resultSection.classList.remove('hidden');
                    compatibilityMessageContainer.classList.remove('bg-green-100', 'text-green-700');
                    compatibilityMessageContainer.classList.add('bg-red-100', 'text-red-700');
                    compatibilityIcon.innerHTML = `<i data-lucide="alert-triangle" class="w-6 h-6 text-red-600"></i>`;
                    compatibilityMessage.textContent = 'Error: API Access Denied.';
                    compatibilityReason.textContent = 'The API service responded with a 403 Forbidden error. This is not an issue with the application code, but with the API key or service itself. Please try again later.';
                    tagsContainer.innerHTML = '';
                    productsContainer.innerHTML = `<p class="col-span-full text-center text-red-500">Error fetching recommendations.</p>`;
                    lucide.createIcons();
                }
            });

            // Set up navigation
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page-content');

            const renderPage = (pageId) => {
                pages.forEach(page => {
                    page.classList.add('hidden');
                });
                document.getElementById(`${pageId}-page`).classList.remove('hidden');

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${pageId}`) {
                        link.classList.add('active');
                    }
                });
            };
            
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = e.currentTarget.getAttribute('href').substring(1);
                    window.history.pushState({}, '', `#${page}`);
                    renderPage(page);
                });
            });

            // Handle browser back/forward buttons
            window.addEventListener('popstate', () => {
                const page = window.location.hash.substring(1) || 'home';
                renderPage(page);
            });

            // Initial load of affiliate products and page render
            fetchAffiliateProducts();
            const initialPage = window.location.hash.substring(1) || 'home';
            renderPage(initialPage);
        });
    </script>
</body>
</html>
